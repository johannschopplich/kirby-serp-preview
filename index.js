(function(){"use strict";const G=/\/$|\/\?|\/#/,M=/^\.?\//;function V(s="",n){return n?G.test(s):s.endsWith("/")}function B(s="",n){if(!n)return s.endsWith("/")?s:s+"/";if(V(s,!0))return s||"/";let t=s,r="";const a=s.indexOf("#");if(a>=0&&(t=s.slice(0,a),r=s.slice(a),!t))return r;const[d,...u]=t.split("?");return d+"/"+(u.length>0?`?${u.join("?")}`:"")+r}function F(s){return s&&s!=="/"}function K(s,...n){let t=s||"";for(const r of n.filter(a=>F(a)))if(t){const a=r.replace(M,"");t=B(t)+a}else t=r;return t}const e=window.Vue;function E(){return window.panel}function P(){return E().api}function q(){const s=P();return{load:({parent:t,name:r})=>s.get(`${t}/sections/${r}`)}}function z(){var n;return((n=e.getCurrentInstance())==null?void 0:n.proxy).$store}const y=e.computed;e.customRef,e.defineAsyncComponent,e.defineComponent,e.effectScope,e.getCurrentInstance,e.getCurrentScope,e.h,e.inject,e.isProxy,e.isReactive,e.isReadonly,e.isRef,e.isShallow,e.markRaw,e.nextTick,e.onActivated,e.onBeforeMount,e.onBeforeUnmount,e.onBeforeUpdate,e.onDeactivated,e.onErrorCaptured,e.onMounted,e.onRenderTracked,e.onRenderTriggered,e.onScopeDispose,e.onServerPrefetch,e.onUnmounted,e.onUpdated,e.provide,e.proxyRefs,e.reactive,e.readonly;const p=e.ref;e.shallowReactive,e.shallowReadonly,e.shallowRef,e.toRaw,e.toRef,e.toRefs,e.triggerRef,e.unref,e.useAttrs,e.useCssModule,e.useCssVars,e.useListeners,e.useSlots;const R=e.watch;e.watchEffect,e.watchPostEffect,e.watchSyncEffect;class W extends Error{constructor(){super("Throttled function aborted"),this.name="AbortError"}}function H({limit:s,interval:n,strict:t,onDelay:r}){if(!Number.isFinite(s))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(n))throw new TypeError("Expected `interval` to be a finite number");const a=new Map;let d=0,u=0;function g(){const l=Date.now();return l-d>n?(u=1,d=l,0):(u<s?u++:(d+=n,u=1),d-l)}const i=[];function f(){const l=Date.now();if(i.length>0&&l-i.at(-1)>n&&(i.length=0),i.length<s)return i.push(l),0;const c=i[0]+n;return i.shift(),i.push(c),Math.max(0,c-l)}const _=t?f:g;return l=>{const c=function(...h){if(!c.isEnabled)return(async()=>l.apply(this,h))();let v;return new Promise((x,C)=>{const w=()=>{x(l.apply(this,h)),a.delete(v)},b=_();b>0?(v=setTimeout(w,b),a.set(v,C),r==null||r()):w()})};return c.abort=()=>{for(const h of a.keys())clearTimeout(h),a.get(h)(new W);a.clear(),i.splice(0,i.length)},c.isEnabled=!0,Object.defineProperty(c,"queueSize",{get(){return a.size}}),c}}const X={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};function J(s,n,t,r,a,d,u,g){var i=typeof s=="function"?s.options:s;n&&(i.render=n,i.staticRenderFns=t,i._compiled=!0),r&&(i.functional=!0),d&&(i._scopeId="data-v-"+d);var f;if(u?(f=function(c){c=c||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!c&&typeof __VUE_SSR_CONTEXT__<"u"&&(c=__VUE_SSR_CONTEXT__),a&&a.call(this,c),c&&c._registeredComponents&&c._registeredComponents.add(u)},i._ssrRegister=f):a&&(f=g?function(){a.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:a),f)if(i.functional){i._injectStyles=f;var _=i.render;i.render=function(h,v){return f.call(v),_(h,v)}}else{var l=i.beforeCreate;i.beforeCreate=l?[].concat(l,f):[f]}return{exports:s,options:i}}const A={...X},Q=Object.assign({inheritAttrs:!1},{__name:"SerpPreview",props:A,setup(s){const n=s,t=E(),r=P(),a=z(),{load:d}=q(),u=p(),g=p(),i=p(),f=p(),_=p(),l=p(),c=p(),h=p(),v=p(),x=p(),C=p(),w=p(""),b=p(""),$=p(""),S=y(()=>a.getters["content/values"]()),ne=y(()=>w.value?new URL(w.value).pathname:""),N=y(()=>S.value[l.value]||c.value||[t.view.title,_.value,i.value].join(" ")),j=y(()=>(h.value?S.value[h.value]:void 0)||v.value);R(()=>t.language.code,async()=>{D();const o=await t.api.get(t.view.path,{select:"previewUrl"});w.value=o.previewUrl},{immediate:!0});const T=H({limit:1,interval:250}),I=T(async o=>{b.value=await U("title",o)}),L=T(async o=>{$.value=await U("description",o)});R(N,o=>{var m,k;(k=(m=C.value)==null?void 0:m.parsers)!=null&&k.title&&I(o)}),R(j,o=>{var m,k;(k=(m=C.value)==null?void 0:m.parsers)!=null&&k.description&&L(o)});async function D(){const o=await d({parent:n.parent,name:n.name});u.value=O(o.label)||t.t("johannschopplich.serp-preview.label"),g.value=o.faviconUrl,i.value=o.siteTitle,f.value=o.siteUrl,_.value=o.titleSeparator,l.value=o.titleContentKey,c.value=o.defaultTitle,h.value=o.descriptionContentKey,v.value=o.defaultDescription,x.value=o.searchConsoleUrl,C.value=o.config}function O(o){return!o||typeof o=="string"?o:o[t.translation.code]??Object.values(o)[0]}async function U(o,m){const k=t.view.path==="site"?void 0:t.view.path.slice(6).replaceAll("+","/"),{text:se}=await r.post(`__serp-preview__/parse/${o}`,{pageId:k,value:m});return se}return{__sfc:!0,propsDefinition:A,props:n,panel:t,api:r,store:a,load:d,label:u,faviconUrl:g,siteTitle:i,siteUrl:f,titleSeparator:_,titleContentKey:l,defaultTitle:c,descriptionContentKey:h,defaultDescription:v,searchConsoleUrl:x,config:C,previewUrl:w,titleProxy:b,descriptionProxy:$,currentContent:S,path:ne,title:N,description:j,throttle:T,throttledGetParsedTitle:I,throttledGetParsedDescription:L,loadSectionProps:D,t:O,getParsedProperty:U,joinURL:K}}});var Y=function(){var n=this,t=n._self._c,r=n._self._setupProxy;return t("k-section",{attrs:{label:r.label}},[t("div",{staticClass:"ksp-overflow-hidden ksp-rounded-[var(--input-rounded)] ksp-bg-[var(--input-color-back)] ksp-p-4"},[t("div",{staticClass:"ksp-mb-2 ksp-flex ksp-items-center ksp-gap-3"},[r.faviconUrl?t("figure",{staticClass:"ksp-inline-flex ksp-aspect-square ksp-h-[26px] ksp-w-[26px] ksp-items-center ksp-justify-center ksp-rounded-full ksp-border ksp-border-solid ksp-border-[#ecedef] ksp-bg-[#f1f3f4]"},[t("img",{staticClass:"ksp-block ksp-h-[18px] ksp-w-[18px]",attrs:{src:r.faviconUrl,alt:""}})]):n._e(),t("div",{staticClass:"ksp-flex ksp-flex-col"},[t("span",{staticClass:"ksp-text-sm ksp-text-[#4d5156]"},[n._v(n._s(r.siteTitle))]),t("span",{staticClass:"ksp-line-clamp-1 ksp-text-xs ksp-text-[#4d5156]"},[n._v(n._s(r.joinURL(r.siteUrl,r.path)))])])]),t("h3",{staticClass:"ksp-line-clamp-1 ksp-text-xl ksp-text-[#1a0dab]"},[n._v(" "+n._s(r.titleProxy||r.title)+" ")]),t("p",{directives:[{name:"show",rawName:"v-show",value:r.description,expression:"description"}],staticClass:"ksp-mt-1 ksp-line-clamp-2 ksp-text-sm ksp-text-[#4d5156]"},[n._v(" "+n._s(r.descriptionProxy||r.description)+" ")])]),t("k-button-group",{directives:[{name:"show",rawName:"v-show",value:r.searchConsoleUrl,expression:"searchConsoleUrl"}],staticClass:"ksp-mt-2 ksp-w-full"},[t("k-button",{attrs:{link:r.searchConsoleUrl,icon:"open",target:"_blank"}},[n._v(" Google Search Console ")])],1)],1)},Z=[],ee=J(Q,Y,Z,!1,null,null,null,null);const te=ee.exports;window.panel.plugin("johannschopplich/serp-preview",{sections:{"serp-preview":te}})})();
