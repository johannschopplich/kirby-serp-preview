(function(){"use strict";const O=/^\.?\//;function B(o="",n){return o.endsWith("/")?o:o+"/"}function K(o){return o&&o!=="/"}function $(o,...n){let t=o||"";for(const s of n.filter(l=>K(l)))if(t){const l=s.replace(O,"");t=B(t)+l}else t=s;return t}function S(){return window.panel}function j(){return S().api}function q(){const o=j();return{load:({parent:t,name:s})=>o.get(`${t}/sections/${s}`)}}function z(){return S().app.$store}const e=window.Vue,x=e.computed;e.customRef,e.defineAsyncComponent,e.defineComponent,e.effectScope,e.getCurrentInstance,e.getCurrentScope,e.h,e.inject,e.isProxy,e.isReactive,e.isReadonly,e.isRef,e.isShallow,e.markRaw,e.nextTick,e.onActivated,e.onBeforeMount,e.onBeforeUnmount,e.onBeforeUpdate,e.onDeactivated,e.onErrorCaptured,e.onMounted,e.onRenderTracked,e.onRenderTriggered,e.onScopeDispose,e.onServerPrefetch,e.onUnmounted,e.onUpdated,e.provide,e.proxyRefs,e.reactive,e.readonly;const c=e.ref;e.shallowReactive,e.shallowReadonly,e.shallowRef,e.toRaw,e.toRef,e.toRefs,e.triggerRef,e.unref,e.useAttrs,e.useCssModule,e.useCssVars,e.useListeners,e.useSlots;const U=e.watch;e.watchEffect,e.watchPostEffect,e.watchSyncEffect;class V extends Error{constructor(){super("Throttled function aborted"),this.name="AbortError"}}function G({limit:o,interval:n,strict:t,onDelay:s}){if(!Number.isFinite(o))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(n))throw new TypeError("Expected `interval` to be a finite number");const l=new Map;let v=0,h=0;function _(){const p=Date.now();return p-v>n?(h=1,v=p,0):(h<o?h++:(v+=n,h=1),v-p)}const r=[];function y(){const p=Date.now();if(r.length>0&&p-r.at(-1)>n&&(r.length=0),r.length<o)return r.push(p),0;const u=r[0]+n;return r.shift(),r.push(u),Math.max(0,u-p)}const g=t?y:_;return p=>{const u=function(...f){if(!u.isEnabled)return(async()=>p.apply(this,f))();let w;return new Promise((C,k)=>{const m=()=>{C(p.apply(this,f)),l.delete(w)},b=g();b>0?(w=setTimeout(m,b),l.set(w,k),s==null||s()):m()})};return u.abort=()=>{for(const f of l.keys())clearTimeout(f),l.get(f)(new V);l.clear(),r.splice(0,r.length)},u.isEnabled=!0,Object.defineProperty(u,"queueSize",{get(){return l.size}}),u}}const W={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};function H(o,n,t,s,l,v,h,_){var r=typeof o=="function"?o.options:o;return n&&(r.render=n,r.staticRenderFns=t,r._compiled=!0),{exports:o,options:r}}const A={...W},J=Object.assign({inheritAttrs:!1},{__name:"SerpPreview",props:A,setup(o){const n=o,t=S(),s=j(),l=z(),{load:v}=q(),h=c(),_=c(),r=c(),y=c(),g=c(),p=c(),u=c(),f=c(),w=c(),C=c(),k=c(),m=c(""),b=c(""),D=c(""),R=x(()=>l.getters["content/values"]()),ee=x(()=>m.value?new URL(m.value).pathname:""),N=x(()=>R.value[p.value]||u.value||[t.view.title,g.value,r.value].join(" ")),F=x(()=>(f.value?R.value[f.value]:void 0)||w.value);U(()=>t.language.code,()=>{E()});const T=G({limit:1,interval:250}),I=T(async a=>{b.value=await P("title",a)}),L=T(async a=>{D.value=await P("description",a)});U(N,a=>{var i,d;(d=(i=k.value)==null?void 0:i.formatters)!=null&&d.title&&I(a)}),U(F,a=>{var i,d;(d=(i=k.value)==null?void 0:i.formatters)!=null&&d.description&&L(a)}),E(!0);async function E(a=!1){const i=await v({parent:n.parent,name:n.name});a&&(h.value=M(i.label)||t.t("johannschopplich.serp-preview.label"),p.value=i.titleContentKey,f.value=i.descriptionContentKey,k.value=i.config,C.value=i.searchConsoleUrl),_.value=i.faviconUrl,r.value=i.siteTitle,y.value=i.siteUrl,g.value=i.titleSeparator,u.value=i.defaultTitle,w.value=i.defaultDescription;const d=await t.api.get(t.view.path,{select:"previewUrl"});m.value=d.previewUrl}function M(a){return!a||typeof a=="string"?a:a[t.translation.code]??Object.values(a)[0]}async function P(a,i){const d=t.view.path.startsWith("pages/")?t.view.path.slice(6).replaceAll("+","/"):void 0,{text:te}=await s.post(`__serp-preview__/format/${a}`,{pageId:d,value:i});return te}return{__sfc:!0,propsDefinition:A,props:n,panel:t,api:s,store:l,load:v,label:h,faviconUrl:_,siteTitle:r,siteUrl:y,titleSeparator:g,titleContentKey:p,defaultTitle:u,descriptionContentKey:f,defaultDescription:w,searchConsoleUrl:C,config:k,previewUrl:m,titleProxy:b,descriptionProxy:D,currentContent:R,path:ee,title:N,description:F,throttle:T,throttledFormatTitle:I,throttledFormatDescription:L,updateSectionData:E,t:M,formatProperty:P,joinURL:$}}});var Q=function(){var n=this,t=n._self._c,s=n._self._setupProxy;return t("k-section",{attrs:{label:s.label}},[t("div",{staticClass:"ksp-overflow-hidden ksp-rounded-[var(--input-rounded)] ksp-bg-[var(--input-color-back)] ksp-p-4"},[t("div",{staticClass:"ksp-mb-2 ksp-flex ksp-items-center ksp-gap-3"},[s.faviconUrl?t("figure",{staticClass:"ksp-inline-flex ksp-aspect-square ksp-h-[26px] ksp-w-[26px] ksp-items-center ksp-justify-center ksp-rounded-full ksp-border ksp-border-solid ksp-border-[#ecedef] ksp-bg-[#f1f3f4]"},[t("img",{staticClass:"ksp-block ksp-h-[18px] ksp-w-[18px]",attrs:{src:s.faviconUrl,alt:""}})]):n._e(),t("div",{staticClass:"ksp-flex ksp-flex-col"},[t("span",{staticClass:"ksp-text-sm ksp-text-[#4d5156]"},[n._v(n._s(s.siteTitle))]),t("span",{staticClass:"ksp-line-clamp-1 ksp-text-xs ksp-text-[#4d5156]"},[n._v(n._s(s.joinURL(s.siteUrl,s.path)))])])]),t("h3",{staticClass:"ksp-line-clamp-1 ksp-text-xl ksp-text-[#1a0dab]"},[n._v(" "+n._s(s.titleProxy||s.title)+" ")]),t("p",{directives:[{name:"show",rawName:"v-show",value:s.description,expression:"description"}],staticClass:"ksp-mt-1 ksp-line-clamp-2 ksp-text-sm ksp-text-[#4d5156]"},[n._v(" "+n._s(s.descriptionProxy||s.description)+" ")])]),t("k-button-group",{directives:[{name:"show",rawName:"v-show",value:s.searchConsoleUrl,expression:"searchConsoleUrl"}],staticClass:"ksp-mt-2 ksp-w-full"},[t("k-button",{attrs:{link:s.searchConsoleUrl,icon:"open",target:"_blank"}},[n._v(" Google Search Console ")])],1)],1)},X=[],Y=H(J,Q,X);const Z=Y.exports;window.panel.plugin("johannschopplich/serp-preview",{sections:{"serp-preview":Z}})})();
