(function(){"use strict";const F=/\/$|\/\?|\/#/,M=/^\.?\//;function V(s="",n){return n?F.test(s):s.endsWith("/")}function B(s="",n){if(!n)return s.endsWith("/")?s:s+"/";if(V(s,!0))return s||"/";let t=s,o="";const a=s.indexOf("#");if(a>=0&&(t=s.slice(0,a),o=s.slice(a),!t))return o;const[d,...u]=t.split("?");return d+"/"+(u.length>0?`?${u.join("?")}`:"")+o}function K(s){return s&&s!=="/"}function W(s,...n){let t=s||"";for(const o of n.filter(a=>K(a)))if(t){const a=o.replace(M,"");t=B(t)+a}else t=o;return t}const e=window.Vue;function E(){return window.panel}function P(){return E().api}function q(){const s=P();return{load:({parent:t,name:o})=>s.get(`${t}/sections/${o}`)}}function z(){var n;return((n=e.getCurrentInstance())==null?void 0:n.proxy).$store}const y=e.computed;e.customRef,e.defineAsyncComponent,e.defineComponent,e.effectScope,e.getCurrentInstance,e.getCurrentScope,e.h,e.inject,e.isProxy,e.isReactive,e.isReadonly,e.isRef,e.isShallow,e.markRaw,e.nextTick,e.onActivated,e.onBeforeMount,e.onBeforeUnmount,e.onBeforeUpdate,e.onDeactivated,e.onErrorCaptured,e.onMounted,e.onRenderTracked,e.onRenderTriggered,e.onScopeDispose,e.onServerPrefetch,e.onUnmounted,e.onUpdated,e.provide,e.proxyRefs,e.reactive,e.readonly;const p=e.ref;e.shallowReactive,e.shallowReadonly,e.shallowRef,e.toRaw,e.toRef,e.toRefs,e.triggerRef,e.unref,e.useAttrs,e.useCssModule,e.useCssVars,e.useListeners,e.useSlots;const R=e.watch;e.watchEffect,e.watchPostEffect,e.watchSyncEffect;class G extends Error{constructor(){super("Throttled function aborted"),this.name="AbortError"}}function H({limit:s,interval:n,strict:t,onDelay:o}){if(!Number.isFinite(s))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(n))throw new TypeError("Expected `interval` to be a finite number");const a=new Map;let d=0,u=0;function g(){const l=Date.now();return l-d>n?(u=1,d=l,0):(u<s?u++:(d+=n,u=1),d-l)}const i=[];function f(){const l=Date.now();if(i.length>0&&l-i.at(-1)>n&&(i.length=0),i.length<s)return i.push(l),0;const c=i[0]+n;return i.shift(),i.push(c),Math.max(0,c-l)}const _=t?f:g;return l=>{const c=function(...h){if(!c.isEnabled)return(async()=>l.apply(this,h))();let v;return new Promise((x,C)=>{const m=()=>{x(l.apply(this,h)),a.delete(v)},b=_();b>0?(v=setTimeout(m,b),a.set(v,C),o==null||o()):m()})};return c.abort=()=>{for(const h of a.keys())clearTimeout(h),a.get(h)(new G);a.clear(),i.splice(0,i.length)},c.isEnabled=!0,Object.defineProperty(c,"queueSize",{get(){return a.size}}),c}}const X={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};function J(s,n,t,o,a,d,u,g){var i=typeof s=="function"?s.options:s;n&&(i.render=n,i.staticRenderFns=t,i._compiled=!0),o&&(i.functional=!0),d&&(i._scopeId="data-v-"+d);var f;if(u?(f=function(c){c=c||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!c&&typeof __VUE_SSR_CONTEXT__<"u"&&(c=__VUE_SSR_CONTEXT__),a&&a.call(this,c),c&&c._registeredComponents&&c._registeredComponents.add(u)},i._ssrRegister=f):a&&(f=g?function(){a.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:a),f)if(i.functional){i._injectStyles=f;var _=i.render;i.render=function(h,v){return f.call(v),_(h,v)}}else{var l=i.beforeCreate;i.beforeCreate=l?[].concat(l,f):[f]}return{exports:s,options:i}}const A={...X},Q=Object.assign({inheritAttrs:!1},{__name:"SerpPreview",props:A,setup(s){const n=s,t=E(),o=P(),a=z(),{load:d}=q(),u=p(),g=p(),i=p(),f=p(),_=p(),l=p(),c=p(),h=p(),v=p(),x=p(),C=p(),m=p(""),b=p(""),$=p(""),S=y(()=>a.getters["content/values"]()),ne=y(()=>m.value?new URL(m.value).pathname:""),N=y(()=>S.value[l.value]||c.value||[t.view.title,_.value,i.value].join(" ")),j=y(()=>(h.value?S.value[h.value]:void 0)||v.value);R(()=>t.language.code,async()=>{D();const r=await t.api.get(t.view.path,{select:"previewUrl"});m.value=r.previewUrl},{immediate:!0});const T=H({limit:1,interval:250}),I=T(async r=>{b.value=await U("title",r)}),L=T(async r=>{$.value=await U("description",r)});R(N,r=>{var w,k;(k=(w=C.value)==null?void 0:w.formatters)!=null&&k.title&&I(r)}),R(j,r=>{var w,k;(k=(w=C.value)==null?void 0:w.formatters)!=null&&k.description&&L(r)});async function D(){const r=await d({parent:n.parent,name:n.name});u.value=O(r.label)||t.t("johannschopplich.serp-preview.label"),g.value=r.faviconUrl,i.value=r.siteTitle,f.value=r.siteUrl,_.value=r.titleSeparator,l.value=r.titleContentKey,c.value=r.defaultTitle,h.value=r.descriptionContentKey,v.value=r.defaultDescription,x.value=r.searchConsoleUrl,C.value=r.config}function O(r){return!r||typeof r=="string"?r:r[t.translation.code]??Object.values(r)[0]}async function U(r,w){const k=t.view.path.startsWith("pages/")?t.view.path.slice(6).replaceAll("+","/"):void 0,{text:se}=await o.post(`__serp-preview__/format/${r}`,{pageId:k,value:w});return se}return{__sfc:!0,propsDefinition:A,props:n,panel:t,api:o,store:a,load:d,label:u,faviconUrl:g,siteTitle:i,siteUrl:f,titleSeparator:_,titleContentKey:l,defaultTitle:c,descriptionContentKey:h,defaultDescription:v,searchConsoleUrl:x,config:C,previewUrl:m,titleProxy:b,descriptionProxy:$,currentContent:S,path:ne,title:N,description:j,throttle:T,throttledFormatTitle:I,throttledFormatDescription:L,loadSectionProps:D,t:O,formatProperty:U,joinURL:W}}});var Y=function(){var n=this,t=n._self._c,o=n._self._setupProxy;return t("k-section",{attrs:{label:o.label}},[t("div",{staticClass:"ksp-overflow-hidden ksp-rounded-[var(--input-rounded)] ksp-bg-[var(--input-color-back)] ksp-p-4"},[t("div",{staticClass:"ksp-mb-2 ksp-flex ksp-items-center ksp-gap-3"},[o.faviconUrl?t("figure",{staticClass:"ksp-inline-flex ksp-aspect-square ksp-h-[26px] ksp-w-[26px] ksp-items-center ksp-justify-center ksp-rounded-full ksp-border ksp-border-solid ksp-border-[#ecedef] ksp-bg-[#f1f3f4]"},[t("img",{staticClass:"ksp-block ksp-h-[18px] ksp-w-[18px]",attrs:{src:o.faviconUrl,alt:""}})]):n._e(),t("div",{staticClass:"ksp-flex ksp-flex-col"},[t("span",{staticClass:"ksp-text-sm ksp-text-[#4d5156]"},[n._v(n._s(o.siteTitle))]),t("span",{staticClass:"ksp-line-clamp-1 ksp-text-xs ksp-text-[#4d5156]"},[n._v(n._s(o.joinURL(o.siteUrl,o.path)))])])]),t("h3",{staticClass:"ksp-line-clamp-1 ksp-text-xl ksp-text-[#1a0dab]"},[n._v(" "+n._s(o.titleProxy||o.title)+" ")]),t("p",{directives:[{name:"show",rawName:"v-show",value:o.description,expression:"description"}],staticClass:"ksp-mt-1 ksp-line-clamp-2 ksp-text-sm ksp-text-[#4d5156]"},[n._v(" "+n._s(o.descriptionProxy||o.description)+" ")])]),t("k-button-group",{directives:[{name:"show",rawName:"v-show",value:o.searchConsoleUrl,expression:"searchConsoleUrl"}],staticClass:"ksp-mt-2 ksp-w-full"},[t("k-button",{attrs:{link:o.searchConsoleUrl,icon:"open",target:"_blank"}},[n._v(" Google Search Console ")])],1)],1)},Z=[],ee=J(Q,Y,Z,!1,null,null,null,null);const te=ee.exports;window.panel.plugin("johannschopplich/serp-preview",{sections:{"serp-preview":te}})})();
