(function(){"use strict";const e=window.Vue;function S(){return window.panel}function A(){return S().api}const D=()=>window.panel.plugins.viewButtons!==void 0;function M(){return D()?new Proxy({},{get(){throw new Error("Vuex store is not available. Are you using Kirby 5? Use the `useContent` composable instead.")}}):S().app.$store}function O(){const s=S(),n=M(),t=D(),o=h(t?()=>s.content.version("changes"):()=>n.getters["content/values"]()),p=h(t?()=>s.content.diff():()=>n.getters["content/changes"]()),u=h(t?()=>s.content.hasDiff():()=>n.getters["content/hasChanges"]()),d=t?s.content:new Proxy({},{get(){return()=>{}}});return{content:d,currentContent:o,contentChanges:p,hasChanges:u,update:async(a,c=!0)=>{if(!t&&a)for(const[y,i]of Object.entries(a))n.dispatch("content/update",[y,i]);const b=d.merge(a);c&&await d.save(b)}}}function B(){const s=S();function n(t){return!t||typeof t=="string"?t:t[s.translation.code]??Object.values(t)[0]}return{t:n}}function z(){const s=A();return{load:({parent:t,name:o})=>s.get(`${t}/sections/${o}`)}}const h=e.computed;e.customRef,e.defineAsyncComponent,e.defineComponent,e.effectScope,e.getCurrentInstance,e.getCurrentScope,e.h,e.inject,e.isProxy,e.isReactive,e.isReadonly,e.isRef,e.isShallow,e.markRaw,e.nextTick,e.onActivated,e.onBeforeMount,e.onBeforeUnmount,e.onBeforeUpdate,e.onDeactivated,e.onErrorCaptured,e.onMounted,e.onRenderTracked,e.onRenderTriggered,e.onScopeDispose,e.onServerPrefetch,e.onUnmounted,e.onUpdated,e.provide,e.proxyRefs,e.reactive,e.readonly;const l=e.ref;e.shallowReactive,e.shallowReadonly,e.shallowRef,e.toRaw,e.toRef,e.toRefs,e.triggerRef,e.unref,e.useAttrs,e.useCssModule,e.useCssVars,e.useListeners,e.useSlots;const T=e.watch;e.watchEffect,e.watchPostEffect,e.watchSyncEffect;const V={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number},$=new FinalizationRegistry(({signal:s,aborted:n})=>{s==null||s.removeEventListener("abort",n)});function q({limit:s,interval:n,strict:t,signal:o,onDelay:p}){if(!Number.isFinite(s))throw new TypeError("Expected `limit` to be a finite number");if(!Number.isFinite(n))throw new TypeError("Expected `interval` to be a finite number");const u=new Map;let d=0,w=0;function a(){const i=Date.now();return i-d>n?(w=1,d=i,0):(w<s?w++:(d+=n,w=1),d-i)}const c=[];function b(){const i=Date.now();if(c.length>0&&i-c.at(-1)>n&&(c.length=0),c.length<s)return c.push(i),0;const f=c[0]+n;return c.shift(),c.push(f),Math.max(0,f-i)}const y=t?b:a;return i=>{const f=function(...m){if(!f.isEnabled)return(async()=>i.apply(this,m))();let _;return new Promise((x,R)=>{const U=()=>{x(i.apply(this,m)),u.delete(_)},C=y();C>0?(_=setTimeout(U,C),u.set(_,R),p==null||p(...m)):U()})},g=()=>{for(const m of u.keys())clearTimeout(m),u.get(m)(o.reason);u.clear(),c.splice(0,c.length)};return $.register(f,{signal:o,aborted:g}),o==null||o.throwIfAborted(),o==null||o.addEventListener("abort",g,{once:!0}),f.isEnabled=!0,Object.defineProperty(f,"queueSize",{get(){return u.size}}),f}}const G=/^\.?\//;function W(s="",n){return s.endsWith("/")?s:s+"/"}function H(s){return s&&s!=="/"}function J(s,...n){let t=s||"";for(const o of n.filter(p=>H(p)))if(t){const p=o.replace(G,"");t=W(t)+p}else t=o;return t}function Q(s,n,t,o,p,u,d,w){var a=typeof s=="function"?s.options:s;return n&&(a.render=n,a.staticRenderFns=t,a._compiled=!0),a._scopeId="data-v-"+u,{exports:s,options:a}}const I={...V},X=Object.assign({inheritAttrs:!1},{__name:"SerpPreview",props:I,setup(s){const n=s,t=S(),o=A(),{t:p}=B(),{load:u}=z(),d=l(),w=l(),a=l(),c=l(),b=l(),y=l(),i=l(),f=l(),g=l(),m=l(),_=l(),x=l(""),R=l(""),U=l(""),{currentContent:C}=O(),ne=h(()=>x.value?new URL(x.value).pathname:""),L=h(()=>C.value[y.value]||i.value||[t.view.title,b.value,a.value].join(" ")),F=h(()=>(f.value?C.value[f.value]:void 0)||g.value);T(()=>t.language.code,()=>{E()});const P=q({limit:1,interval:250}),N=P(async v=>{R.value=await j("title",v)}),K=P(async v=>{U.value=await j("description",v)});T(L,v=>{var r,k;(k=(r=_.value)==null?void 0:r.formatters)!=null&&k.title&&N(v)}),T(F,v=>{var r,k;(k=(r=_.value)==null?void 0:r.formatters)!=null&&k.description&&K(v)}),E(!0);async function E(v=!1){const r=await u({parent:n.parent,name:n.name});v&&(d.value=p(r.label)||t.t("johannschopplich.serp-preview.label"),y.value=r.titleContentKey,f.value=r.descriptionContentKey,_.value=r.config,m.value=r.searchConsoleUrl),w.value=r.faviconUrl,a.value=r.siteTitle,c.value=r.siteUrl,b.value=r.titleSeparator,i.value=r.defaultTitle,g.value=r.defaultDescription;const k=await t.api.get(t.view.path,{select:"previewUrl"});x.value=k.previewUrl}async function j(v,r){const k=t.view.path.startsWith("pages/")?t.view.path.slice(6).replaceAll("+","/"):void 0,{data:se}=await o.post(`__serp-preview__/format/${v}`,{pageId:k,value:r});return se.text}return{__sfc:!0,propsDefinition:I,props:n,panel:t,api:o,t:p,load:u,label:d,faviconUrl:w,siteTitle:a,siteUrl:c,titleSeparator:b,titleContentKey:y,defaultTitle:i,descriptionContentKey:f,defaultDescription:g,searchConsoleUrl:m,config:_,previewUrl:x,titleProxy:R,descriptionProxy:U,currentContent:C,path:ne,title:L,description:F,throttle:P,throttledFormatTitle:N,throttledFormatDescription:K,updateSectionData:E,formatProperty:j,joinURL:J}}});var Y=function(){var n=this,t=n._self._c,o=n._self._setupProxy;return t("k-section",{staticClass:"k-serp-section",attrs:{label:o.label}},[t("div",{staticClass:"ksp-overflow-hidden ksp-rounded-[var(--input-rounded)] ksp-bg-[var(--input-color-back)] ksp-p-4"},[t("div",{staticClass:"ksp-mb-2 ksp-flex ksp-items-center ksp-gap-3"},[o.faviconUrl?t("figure",{staticClass:"ksp-inline-flex ksp-aspect-square ksp-h-[26px] ksp-w-[26px] ksp-items-center ksp-justify-center ksp-rounded-full ksp-border ksp-border-solid ksp-border-[var(--serp-favicon-border)] ksp-bg-[var(--serp-favicon-background)]"},[t("img",{staticClass:"ksp-block ksp-h-[18px] ksp-w-[18px]",attrs:{src:o.faviconUrl,alt:""}})]):n._e(),t("div",{staticClass:"ksp-flex ksp-flex-col"},[t("span",{staticClass:"ksp-text-sm ksp-text-[var(--serp-color-text)]"},[n._v(n._s(o.siteTitle))]),t("span",{staticClass:"ksp-line-clamp-1 ksp-text-xs ksp-text-[var(--serp-color-text)]"},[n._v(n._s(o.joinURL(o.siteUrl,o.path)))])])]),t("h3",{staticClass:"ksp-line-clamp-1 ksp-text-xl ksp-text-[var(--serp-color-title)]"},[n._v(" "+n._s(o.titleProxy||o.title)+" ")]),t("p",{directives:[{name:"show",rawName:"v-show",value:o.description,expression:"description"}],staticClass:"ksp-mt-1 ksp-line-clamp-2 ksp-text-sm ksp-text-[var(--serp-color-text)]"},[n._v(" "+n._s(o.descriptionProxy||o.description)+" ")])]),t("k-button-group",{directives:[{name:"show",rawName:"v-show",value:o.searchConsoleUrl,expression:"searchConsoleUrl"}],staticClass:"ksp-mt-2 ksp-w-full"},[t("k-button",{attrs:{link:o.searchConsoleUrl,icon:"open",target:"_blank"}},[n._v(" Google Search Console ")])],1)],1)},Z=[],ee=Q(X,Y,Z,!1,null,"d214a0b2");const te=ee.exports;window.panel.plugin("johannschopplich/serp-preview",{sections:{"serp-preview":te}})})();
